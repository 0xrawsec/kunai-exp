# Sample

BPFDoor sample

<table>
  <tr>
    <td><b>Filename</b></td>
    <td>bpfdoor.mwr</td>
  </tr>
  <tr>
    <td><b>md5</b></td>
    <td>0017f7b913ce66e4d80f7e78cf830a2b</td>
  </tr>
  <tr>
    <td><b>sha1</b></td>
    <td>f1bf775746a5c882b9ec003617b2a70cf5a5b029</td>
  </tr>
  <tr>
    <td><b>sha256</b></td>
    <td>fa0defdabd9fd43fe2ef1ec33574ea1af1290bd3d763fdb2bed443f2bd996d73</td>
  </tr>
  <tr>
    <td><b>sha512</b></td>
    <td>ff5dd28ba3f5ce1f85f85fa9b65f9f30fbd300f2ca238cb2713da7077b7a0a8ff094cff4d7de9381726925abdd9ea065fa75ccd02fa5a816b71a6f91479363c1</td>
  </tr>
</table>

Virustotal: https://www.virustotal.com/gui/file/fa0defdabd9fd43fe2ef1ec33574ea1af1290bd3d763fdb2bed443f2bd996d73

Related links:
* [Code sample (probably not exactly the same one)](https://github.com/gwillgues/BPFDoor/blob/main/bpfdoor.c)
* https://www.countercraftsec.com/blog/a-step-by-step-bpfdoor-compromise/
* https://exatrack.com/public/Tricephalic_Hellkeeper.pdf
* https://www.trendmicro.com/en_us/research/23/g/detecting-bpfdoor-backdoor-variants-abusing-bpf-filters.html


# Experiment

<table>
  <tr>
    <td><b>Distribution</b></td>
    <td>Ubuntu-20.04</td>
  </tr>
  <tr>
    <td><b>OS</b></td>
    <td>5.4.0-153-generic</td>
  </tr>
  <tr>
    <td><b>Kunai</b></td>
    <td>0.1.0</td>
  </tr>
  <tr>
    <td><b>Output</b></td>
    <td>ouput.jsonl</td>
  </tr>
</table>

1. Run Kunai in such a way you capture the output (redirect output to file or configure output file)
2. Run malware. Make sure the malware is not already running because it checks if an instance is already running and exits if it is the case.
3. Wait a bit and send commands to the backdoor if you can

NB: For this experiment IÂ haven't reverse the sample and didn't send commands

Lessons learned:
* https://github.com/0xrawsec/kunai/issues/1
* https://github.com/0xrawsec/kunai/issues/2
* https://github.com/0xrawsec/kunai/issues/3
* https://github.com/0xrawsec/kunai/issues/4
